<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login - Dayflow HRMS</title>
    <link rel="stylesheet" href="./css/style.css">
</head>
<body>
    <div class="container">
        <div class="card" style="max-width: 480px; margin: 4rem auto; backdrop-filter: blur(20px);">
            <div class="text-center mb-4">
                <div style="display: inline-block; margin-bottom: 1.5rem;">
                    <img src="./logos/dayflow.png" alt="Dayflow" style="height: 80px; width: auto; animation: float 3s ease-in-out infinite;">
                </div>
                <h1 style="background: linear-gradient(135deg, var(--primary-color), var(--primary-dark)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; margin-bottom: 0.5rem; font-size: 2rem; font-weight: 900;">Dayflow</h1>
                <p style="color: var(--light-text); font-size: 0.95rem; font-weight: 500;">Human Resource Management System</p>
                <h2 class="mt-4" style="font-size: 1.75rem; font-weight: 800; color: var(--dark-text);">Welcome Back</h2>
                <p style="color: var(--light-text); font-size: 0.9rem; margin-top: 0.5rem;">Sign in to continue to your dashboard</p>
            </div>

            <div id="alertContainer"></div>

            <form id="loginForm">
                <div class="form-group">
                    <label class="form-label" for="email">
                        <img src="./logos/mail.png" alt="Email" style="height: 16px; width: auto; vertical-align: middle; margin-right: 6px;">
                        Email Address
                    </label>
                    <input type="email" id="email" class="form-input" placeholder="your.email@company.com" required>
                </div>

                <div class="form-group">
                    <label class="form-label" for="password">
                        <img src="./logos/password.png" alt="Password" style="height: 16px; width: auto; vertical-align: middle; margin-right: 6px;">
                        Password
                    </label>
                    <input type="password" id="password" class="form-input" placeholder="Enter your password" required>
                </div>

                <button type="submit" class="btn btn-primary btn-full" style="margin-top: 1.5rem; padding: 1rem;">
                    <span>Sign In</span>
                    <span style="margin-left: 0.5rem;">→</span>
                </button>
            </form>

            <div class="text-center mt-4">
                <p style="color: var(--light-text); font-size: 0.95rem;">
                    Don't have an account? 
                    <a href="./signup.html" style="color: var(--primary-color); text-decoration: none; font-weight: 700; position: relative; display: inline-block;">
                        Sign Up
                        <span style="position: absolute; bottom: -2px; left: 0; width: 100%; height: 2px; background: linear-gradient(90deg, var(--primary-color), var(--primary-light)); transform: scaleX(0); transform-origin: left; transition: transform 0.25s;"></span>
                    </a>
                </p>
            </div>
        </div>
    </div>

    <script src="./js/app.js"></script>
    <script>
        document.getElementById('loginForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const alertContainer = document.getElementById('alertContainer');

            // Clear previous alerts
            alertContainer.innerHTML = '';

            // Validation
            if (!validate.email(email)) {
                alertContainer.innerHTML = '<div class="alert alert-error">Please enter a valid email address</div>';
                return;
            }

            if (!validate.required(password)) {
                alertContainer.innerHTML = '<div class="alert alert-error">Password is required</div>';
                return;
            }

            try {
                const submitBtn = e.target.querySelector('button[type="submit"]');
                submitBtn.disabled = true;
                submitBtn.innerHTML = '<span>Signing In...</span><span style="margin-left: 0.5rem;">⏳</span>';

                const response = await api.post('/auth/signin', { email, password });

                if (response.success) {
                    auth.setAuth(response.token, response.user);
                    alertContainer.innerHTML = '<div class="alert alert-success">✓ Login successful! Redirecting...</div>';
                    
                    setTimeout(() => {
                        const redirectUrl = response.user.role === 'admin' || response.user.role === 'hr' 
                            ? './admin-dashboard.html' 
                            : './employee-dashboard.html';
                        window.location.href = redirectUrl;
                    }, 1000);
                } else {
                    throw new Error(response.message || 'Login failed');
                }
            } catch (error) {
                alertContainer.innerHTML = `<div class="alert alert-error">✕ ${error.message}</div>`;
                const submitBtn = e.target.querySelector('button[type="submit"]');
                submitBtn.disabled = false;
                submitBtn.innerHTML = '<span>Sign In</span><span style="margin-left: 0.5rem;">→</span>';
            }
        });
    </script>
</body>
</html>
